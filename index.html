<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pirate Town</title>
    <link rel="stylesheet" href="styles.css">
    <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <script src="https://files.codepedia.info/files/uploads/iScripts/html2canvas.js"></script>
    <script>
        $( document ).ready(function() {
            var buildings = ['normal', 'alt'];
            var bonuses = ['normal', 'alt', 'hidden'];
            var flags = ['UK', 'US'];

            $('#randomize').on('click', function randomize() {
                $('i.building').each(function(index, element) {

                    $(element).removeClass('normal alt').addClass(buildings[Math.floor(Math.random() * buildings.length)]);
                });
                $('i.bonus').each(function(index, element) {

                    $(element).removeClass('normal alt hidden').addClass(bonuses[Math.floor(Math.random() * bonuses.length)]);
                });
                $('i.flag').each(function(index, element) {

                    $(element).removeClass('UK US').addClass(flags[Math.floor(Math.random() * flags.length)]);
                });
            })


            var element = $("#html-content-holder"); // global variable
            var getCanvas; // global variable

            $("#btn-Preview-Image").on('click', function () {
                html2canvas(element, {
                    onrendered: function (canvas) {
                        $("#previewImage").html(canvas);
                        getCanvas = canvas;
                    }
                });
            });

            $("#btn-Convert-Html2Image").on('click', function () {
                var imgageData = getCanvas.toDataURL("image/png");
                // Now browser starts downloading it instead of just showing it
                var newData = imgageData.replace(/^data:image\/png/, "data:application/octet-stream");
                var name = $('h1').text();
                $("#btn-Convert-Html2Image").attr("download", name+".png").attr("href", newData);
            });

        });
    </script>
</head>
<body>
<div class="controls">
    <button id="randomize" class="button">Randomize</button>

    <button id="btn-Preview-Image" type="button" class="button">Preview</button>
    <a id="btn-Convert-Html2Image" href="#" class="button">Download</a>
</div>
<div class="content">
    <div>

        <div id="html-content-holder" class="sprite sprite-Stronghold">
            <h1 contenteditable="true">Town Name</h1>
            <i class="sprite flag"></i>
            <i class="sprite building sprite-m1">
                <i class="sprite bonus sprite-b1 hidden"></i>
            </i>
            <i class="sprite building sprite-m2">
                <i class="sprite bonus sprite-b2 hidden"></i>
            </i>
            <i class="sprite building sprite-m3">
                <i class="sprite bonus sprite-b3 hidden"></i>
            </i>
            <i class="sprite building sprite-m4">
                <i class="sprite bonus sprite-b4 hidden"></i>
            </i>
            <i class="sprite building sprite-m5">
                <i class="sprite bonus sprite-b5 hidden"></i>
            </i>
            <i class="sprite building sprite-m6">
                <i class="sprite bonus sprite-b6 hidden"></i>
            </i>
            <i class="sprite building sprite-m7">
                <i class="sprite bonus sprite-b7 hidden"></i>
            </i>
            <i class="sprite building sprite-m8">
                <i class="sprite bonus sprite-b8 hidden"></i>
            </i>
            <i class="sprite building sprite-m9">
                <i class="sprite bonus sprite-b9 hidden"></i>
            </i>

        </div>
    </div>
    <div id="previewImage" class="preview"></div>
</div>
</body>
</html>
